---
title: "GDP and Earthquake Deaths Analysis"
author: "Hailun Ma"
format:
  html:
    theme: cosmo
    toc: true
    toc-depth: 2
    code-fold: true
jupyter: python3
execute:
  echo: true
  warning: false
  message: false
---

## Question 1
Will earthquakes affect the country's GDP development ？

finds out the top 5 countries with the most frequent earthquakes
```{python}
import pandas as pd
import matplotlib.pyplot as plt

df_eq = pd.read_csv("cleaned_data/Global_earthquake_20th_century_cleaned.csv")

top_countries = df_eq["region"].value_counts().head(5).reset_index()
top_countries.columns = ["Country", "Earthquake Count"]

print("Top5-earthquake-countries：")
print(top_countries)

plt.figure(figsize=(8, 5))
plt.bar(top_countries["Country"], top_countries["Earthquake Count"], color='tomato')
plt.title("Top 5 Countries by Earthquake Frequency (20th Century)")
plt.xlabel("Country")
plt.ylabel("Earthquake Count")
plt.tight_layout()
plt.grid(axis='y', linestyle='--', alpha=0.7)
plt.show()
```
## 
plots the time trend of GDP for these countries + labeled years of earthquakes
```{python}
import pandas as pd
import plotly.graph_objects as go
import numpy as np

df_gdp = pd.read_csv("cleaned_data/Global_GDP_cleaned.csv")
df_eq = pd.read_csv("cleaned_data/Global_earthquake_20th_century_cleaned.csv")

display_names = ["Turkey", "Iran", "China", "United States", "Japan"]
gdp_names = ["Turkiye", "Iran, Islamic Rep.", "China", "United States", "Japan"]
country_map = dict(zip(gdp_names, display_names))

df_gdp = df_gdp[df_gdp["Country Name"].isin(gdp_names)].copy()
df_gdp["Display Name"] = df_gdp["Country Name"].map(country_map)
df_gdp["GDP_log"] = np.log10(df_gdp["GDP"])  

df_eq = df_eq[df_eq["region"].isin(display_names)]

fig = go.Figure()

for gdp_name, disp_name in country_map.items():
    data = df_gdp[df_gdp["Country Name"] == gdp_name]
    fig.add_trace(go.Scatter(
        x=data["Year"], y=data["GDP_log"],
        mode="lines+markers",
        name=disp_name,
        hovertemplate=(
            f"<b>{disp_name}</b><br>Year: %{{x}}<br>GDP: $%{{customdata:.2e}}"
        ),
        customdata=data["GDP"]
    ))

    eq_years = df_eq[df_eq["region"] == disp_name]["year"].drop_duplicates().sort_values()
    gdp_eq_all = data[data["Year"].isin(eq_years)]
    gdp_eq_label = gdp_eq_all.head(3)  

    fig.add_trace(go.Scatter(
        x=gdp_eq_all["Year"], y=gdp_eq_all["GDP_log"],
        mode="markers",
        marker=dict(color="black", size=8, symbol="x"),
        name=f"{disp_name} Earthquakes",
        hovertemplate=f"<b>{disp_name}</b><br>Earthquake Year: %{{x}}<extra></extra>",
        showlegend=False
    ))

    fig.add_trace(go.Scatter(
        x=gdp_eq_label["Year"], y=gdp_eq_label["GDP_log"],
        mode="text",
        text=gdp_eq_label["Year"],
        textposition="top center",
        textfont=dict(size=10, color="black"),
        showlegend=False,
        hoverinfo="skip"
    ))

fig.update_layout(
    title="Log GDP Trend with Earthquake Years (Top 5 Earthquake Countries)",
    xaxis_title="Year",
    yaxis_title="log₁₀(GDP in US$)",
    height=650,
    width=1100,
    template="plotly_white",
    hovermode="x unified"
)

fig.show()
```
##
The chart illustrates the log-scaled GDP trends of the five countries that experienced the most earthquakes in the 20th century: Turkey, Iran, China, the United States, and Japan

For Turkey, the GDP trend from 1960 to the early 1990s showed modest growth. However, in the late 1990s, a noticeable flattening is observed around 1999, coinciding with the devastating İzmit earthquake

In Iran, the GDP trajectory is more volatile than other countries. Significant earthquakes occurred in the 1970s, 1990, and early 2000s. While some dips in GDP growth align with earthquake years (e.g., 1990), it is difficult to isolate earthquakes as the primary cause, given overlapping political and economic events such as sanctions and oil market fluctuations.

China displays a strong and consistent upward trend in GDP across the decades, including during years with major earthquakes, such as the 1976 Tangshan earthquake and the 2008 Sichuan earthquake. There is no clear downturn in GDP growth following these events, suggesting a high level of economic resilience and capacity for rapid recovery

The United States also maintains a stable and steadily rising GDP trend, with earthquakes such as the 1989 Loma Prieta and 1994 Northridge events causing no visible deviation in the growth trajectory. This may reflect the country's diversified economy and robust disaster response infrastructure.

Japan, on the other hand, shows a few distinct deviations that align with major seismic events. Notably, in 1995, GDP growth flattens in the aftermath of the Great Hanshin (Kobe) earthquake. Similarly, a small disruption is visible around 2011, the year of the Tohoku earthquake and tsunami

Overall, while some short-term economic disruptions are observable—especially in Turkey and Japan—most countries exhibit resilient long-term GDP growth following earthquakes. The use of a logarithmic scale helps reveal relative changes across countries with vastly different GDP sizes, and makes subtle year-over-year variations more visible. This suggests that while earthquakes can impose temporary economic costs, macroeconomic recovery is common, particularly in nations with stronger infrastructure and economic foundations.

## Question 2
Is there a relationship between the number of deaths from earthquakes and a country's GDP (do countries with lower GDPs have higher death rates due to poor infrastructure and poor disaster response?)

Find the countries with low GDP and well-documented earthquake data
```{python}
import pandas as pd
df_gdp = pd.read_csv("cleaned_data/Global_GDP_cleaned.csv")

latest_year = df_gdp["Year"].max()
latest_gdp = df_gdp[df_gdp["Year"] == latest_year]
lowest_gdp_countries = latest_gdp.dropna(subset=["GDP"]).sort_values(by="GDP").head(5)

print(f"Lowest 5 GDP Countries in {latest_year}:")
print(lowest_gdp_countries[["Country Name", "Country Code", "Year", "GDP"]])
```
## 
Find out in which year the 5 countries with the lowest GDP had major earthquakes and death tolls
```{python}
import pandas as pd

df_gdp = pd.read_csv("cleaned_data/Global_GDP_cleaned.csv")
df_eq = pd.read_csv("cleaned_data/Global_earthquake_20th_century_cleaned.csv")

eq_years_full = df_eq[["region", "year", "richter", "deaths"]].dropna()

gdp_eq_full = pd.merge(
    eq_years_full,
    df_gdp,
    left_on=["region", "year"],
    right_on=["Country Name", "Year"],
    how="inner"
)

gdp_eq_complete = gdp_eq_full[["region", "year", "GDP", "richter", "deaths"]].dropna()
gdp_eq_complete = gdp_eq_complete.sort_values(by=["region", "year"])

avg_gdp_complete = (
    gdp_eq_complete.groupby("region")["GDP"]
    .mean()
    .reset_index()
    .sort_values(by="GDP")
)

low_gdp_complete_countries = avg_gdp_complete.head(5)["region"].tolist()

gdp_eq_complete_low = gdp_eq_complete[
    gdp_eq_complete["region"].isin(low_gdp_complete_countries)
]

print("5 earthquake countries with lower GDP：")
print(gdp_eq_complete_low)
```
```{python}
import pandas as pd
import matplotlib.pyplot as plt
import matplotlib.ticker as ticker

df_gdp = pd.read_csv("cleaned_data/Global_GDP_cleaned.csv")
df_eq = pd.read_csv("cleaned_data/Global_earthquake_20th_century_cleaned.csv")

eq_years_full = df_eq[["region", "year", "richter", "deaths"]].dropna()

gdp_eq_full = pd.merge(
    eq_years_full,
    df_gdp,
    left_on=["region", "year"],
    right_on=["Country Name", "Year"],
    how="inner"
)

gdp_eq_complete = gdp_eq_full[["region", "year", "GDP", "richter", "deaths"]].dropna()

avg_gdp_complete = (
    gdp_eq_complete.groupby("region")["GDP"]
    .mean()
    .reset_index()
    .sort_values(by="GDP")
)

low_gdp_complete_countries = avg_gdp_complete.head(5)["region"].tolist()

gdp_eq_complete_low = gdp_eq_complete[
    gdp_eq_complete["region"].isin(low_gdp_complete_countries)
]

labels = gdp_eq_complete_low["region"] + " (" + gdp_eq_complete_low["year"].astype(str) + ")"
gdp_values = gdp_eq_complete_low["GDP"]
deaths = gdp_eq_complete_low["deaths"]

plt.figure(figsize=(10, 6))
bars = plt.barh(labels, gdp_values, color="steelblue")

formatter = ticker.FuncFormatter(lambda x, pos: f"${x/1e9:.2f}B" if x >= 1e9 else f"${x/1e6:.0f}M")
plt.gca().xaxis.set_major_formatter(formatter)

for bar, death in zip(bars, deaths):
    width = bar.get_width()
    plt.text(width + width * 0.02, bar.get_y() + bar.get_height() / 2,
             f"{int(death):,} deaths", va="center", fontsize=9)

plt.xlabel("GDP in Earthquake Year (US$)")
plt.title("GDP vs Earthquake Deaths (Lowest 5 GDP Countries)")
plt.grid(axis="x", linestyle="--", alpha=0.5)
plt.tight_layout()
plt.show()
```
##
Horizontal bars of GDP for the top 5 countries with the highest GDP in the year of the earthquake, by peer comparison
```{python}
import pandas as pd
import matplotlib.pyplot as plt
import matplotlib.ticker as ticker

df_gdp = pd.read_csv("cleaned_data/Global_GDP_cleaned.csv")
df_eq = pd.read_csv("cleaned_data/Global_earthquake_20th_century_cleaned.csv")

eq_years_full = df_eq[["region", "year", "richter", "deaths"]].dropna()
gdp_eq_full = pd.merge(
    eq_years_full,
    df_gdp,
    left_on=["region", "year"],
    right_on=["Country Name", "Year"],
    how="inner"
)
gdp_eq_complete = gdp_eq_full[["region", "year", "GDP", "richter", "deaths"]].dropna()

avg_gdp_complete_high = (
    gdp_eq_complete.groupby("region")["GDP"]
    .mean()
    .reset_index()
    .sort_values(by="GDP", ascending=False)
)
high_gdp_countries = avg_gdp_complete_high.head(5)["region"].tolist()

gdp_eq_complete_high = gdp_eq_complete[
    gdp_eq_complete["region"].isin(high_gdp_countries)
]

labels_high = gdp_eq_complete_high["region"] + " (" + gdp_eq_complete_high["year"].astype(str) + ")"
gdp_values_high = gdp_eq_complete_high["GDP"]
deaths_high = gdp_eq_complete_high["deaths"]

plt.figure(figsize=(10, 6))
bars = plt.barh(labels_high, gdp_values_high, color="seagreen")

formatter = ticker.FuncFormatter(lambda x, pos: f"${x/1e9:.2f}B" if x >= 1e9 else f"${x/1e6:.0f}M")
plt.gca().xaxis.set_major_formatter(formatter)

for bar, death in zip(bars, deaths_high):
    width = bar.get_width()
    plt.text(width + width * 0.02, bar.get_y() + bar.get_height() / 2,
             f"{int(death):,} deaths", va="center", fontsize=9)

plt.xlabel("GDP in Earthquake Year (US$)")
plt.title("GDP vs Earthquake Deaths (Highest 5 GDP Countries)")
plt.grid(axis="x", linestyle="--", alpha=0.5)
plt.tight_layout()
plt.show()
```
## 
Low-GDP countries, such as Guatemala (1976) and Morocco (1960), experienced devastating death tolls of 23,000 and 12,000 respectively, despite relatively moderate earthquake magnitudes. These countries had earthquake-year GDPs below $5 billion, and often lacked robust infrastructure or effective disaster response systems.

In contrast, high GDP countries like Japan and the United States show significantly lower death counts, even when hit by powerful earthquakes. For instance, Japan (1995), despite facing a magnitude 7.2 quake, reported 6,434 deaths which is a high number, but relatively modest given the country’s population size and economic scale. The USA (1994) reported only 57 deaths from a magnitude 6.9 quake, backed by over $7 trillion in GDP at the time.

This contrast underscores the relationship between economic capacity and disaster resilience: higher GDP nations tend to have stronger building codes, early warning systems, and emergency response capabilities, all of which contribute to lower mortality rates.

Overall, this visual and numeric comparison supports the hypothesis that earthquakes are far deadlier in low GDP countries, not necessarily due to the strength of the quake itself, but because of systemic vulnerabilities in infrastructure, preparedness, and emergency response.